Проект Радио-86РК на железе Maximite
====================================

**ВНИМАНИЕ** *Данный документ не является полноценной документацией. Здесь
собраны некоторые полезные факты. Для более детальной информации надо
смотреть код или можно написать мне письмо.*

Программный эмулятор процессора Intel 8080 (КР580) и аппаратуры Радио-86РК
работает на микрокомпьютере Maximite. Maximite основан на PIC32. Тактовая
частота PIC32 80MHz, частота эмулируемого КР580 - 1.78MHz. 

[Maximite]: http://geoffg.net/maximite.html


Процессор
=========

Частота Intel 8080
------------------

    1.78MHz (16/9)

    1,780,000Hz

    T = 1 / 1780000 = 0.0000005625s = 0.0005625ms = 0.5625mks = 5.625us

    T = 1 / 2000000 = 0.0000005000s = 0.0005000ms = 0.5000msk = 5us

Частота PIC32
-------------

    80MHz = 80,000,000

    T = 1 / 80000000 = 0.0000000125s = 0.0000125ms = 0.0125mks = 0.125us

    PIC32_FREQ = 80000000
    I8080_RK86_FREQ = 2000000

Длительность такта I8080 в тактах PIC32
---------------------------------------

    RK86_I8080_PERIOD = PIC32_FREQ / I8080_RK86_FREQ = ~40


Видео
=====

Программно создается видео сигнал VGA. Подробности в файле `video.c`. 
Эмуляция экрана РК (знакогенератора и курсора) -- файл `rk86_video.c`.

В пикселях:

    480 x 432

В знакоместах:

    480 / 6 = 80
    300 / 80 = 30

Экран РК86
----------

    screen_width = 78
    screen_height = 30

    char_width = 6
    char_height = 8
    char_height_gap = 2

    cursor_width = char_width
    cursor_height = 1

    canvas.width = screen_width * char_width * scale_x
    canvas.height = screen_height * (char_height + char_height_gap) * scale_y


Клавиатура
==========

- Стандартный PS/2 протокол.
- [Коды клавиш](http://www.computer-engineering.org/ps2keyboard/scancodes2.html).


Звук
====

Команды процессора EI/DI, используемые в РК для генерации звука,
соответственно, выставляют и сбрасывают бит `PORTBbits.RB4`.

Внешняя пищалка подключена на ножку RB4. Пищалкой является любой низкоомный
небольшой динамик, подключенный последовательно через неинвертирующий буфер
и емкость в 10mkF (для защиты по постоянному току). Схема включения аналогична
оригинальной из РК.

                   +-----+    C1 10mkF
    6 (RB4)      3 |     | 2   ||+
    >--------------+     +-----||------+
    4 (+5V)      8 |     |     ||      |
    >--------------+     |             |
    2 (GND)        |     |             |
    >-------+------+     |             |
            |      +-----+             |
            |        IC1              +++
            |     74HC4050E           | |/|  SP1
            |                         | |\| 
            |                         +++ 
            |                          |
            |                          |     
          --+--                      --+-- GND

Ножка RB4 заведена на пин GPIO6 (в нотации MMBasic). На физическом разъеме
Maximite это пин номер 6. Питания для IC1 берется с пина 4. Земля - пин 2.
Так как все эти три ножки на разъеме расположены рядом, их удобно подключить
трехпиновым проводочком с разъемом на конце.

Ножка `PORTBbits.RB4`.

Программирование на вывод:

        TRISBbits.TRISB4 = 0;
        
Управление:

        PORTBbits.RB4 = on;


"Железки" Maximite
==================

Полная информация о Maximite находится на его официальном сайте.
Тут я собрал только минимум, относящийся к Радио-86РК.

Зеленый светодиод
-----------------

Ножка `PORTFbits.RF0`.

Программирование на вывод:

    TRISFbits.TRISF0 = 0;

Управление:

    PORTFbits.RF0 = on;

Красный светодиод
-----------------

Ножка `PORTEbits.RE1`.

Программирование на вывод:

    TRISEbits.TRISE1 = 0;

Управление:

    PORTEbits.RE1 = on;

Микро-тумблер для перевода в режим Bootloader'а
-----------------------------------------------

Ножка `PORTCbits.RC13`.

Программирование на ввод:

    TRISCbits.TRISC13 = 1;

Проверка:

    if (PORTCbits.RC13 == 0) SoftReset();
